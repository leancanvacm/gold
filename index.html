<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบออมทอง</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Fixed Tab Styles - แก้ไขให้อยู่ด้านล่างเสมอ */
        .bottom-tabs {
            position: fixed !important;
            bottom: 0 !important;
            left: 0 !important;
            right: 0 !important;
            z-index: 9999 !important;
            background: white;
            border-top: 1px solid #e5e7eb;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            height: 70px !important;
        }
        
        .tab-button {
            color: #6b7280;
            transition: all 0.2s ease;
            border-bottom: 3px solid transparent;
            padding: 12px 8px !important;
            font-size: 14px;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .tab-button:hover {
            color: #374151;
            background-color: #f9fafb;
        }
        
        .tab-button.active {
            color: #f59e0b !important;
            border-bottom-color: #f59e0b !important;
            background-color: #fffbeb;
            font-weight: 600;
        }
        
        /* Page container styles - เพิ่มพื้นที่ด้านล่างสำหรับ tabs */
        .page-content {
            padding-bottom: 80px !important;
            min-height: calc(100vh - 160px) !important;
            overflow-y: auto;
        }
        
        /* App container */
        #app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        /* Loading and other styles */
        #loading {
            transition: opacity 0.3s ease-out, transform 0.3s ease-out;
        }
        
        .card-hover, .btn-animate {
            will-change: transform;
            transform: translateZ(0);
            transition: all 0.2s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .btn-animate:active {
            transform: scale(0.95);
        }
        
        /* Prevent body scroll when needed */
        body {
            overflow-x: hidden;
            font-family: 'Prompt', sans-serif;
        }
        
        /* Mobile specific styles */
        @media (max-width: 768px) {
            .bottom-tabs {
                height: 65px !important;
            }
            
            .page-content {
                padding-bottom: 75px !important;
            }
        }
        
        /* Smooth transitions */
        .content-section {
            transition: opacity 0.3s ease-in-out;
        }
        
        .content-section.hidden {
            display: none !important;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Mobile Only Warning Screen -->
    <div id="mobileOnlyWarning" class="fixed inset-0 bg-gray-900 bg-opacity-95 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg p-8 max-w-md mx-4 text-center">
            <div class="mb-6">
                <i class="fas fa-mobile-alt text-6xl text-blue-500 mb-4"></i>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">แอปพลิเคชันสำหรับมือถือเท่านั้น</h2>
                <p class="text-gray-600 mb-6">กรุณาเข้าใช้งานระบบออมทองผ่านมือถือหรือแท็บเล็ตเท่านั้น</p>
            </div>
            <div class="text-left bg-gray-50 rounded-lg p-4 mb-6">
                <h3 class="font-semibold text-gray-800 mb-2">วิธีการเข้าใช้งาน:</h3>
                <ul class="text-sm text-gray-600 space-y-1">
                    <li>• เปิดผ่าน LINE Official Account</li>
                    <li>• ใช้งานบนมือถือหรือแท็บเล็ต</li>
                    <li>• ตรวจสอบให้แน่ใจว่าเปิดผ่าน LIFF</li>
                </ul>
            </div>
            <div class="text-xs text-gray-500 mb-4">
                <p>หากคุณใช้งานบนมือถืออยู่แล้ว กรุณารีเฟรชหน้าเว็บ</p>
            </div>
            
            <!-- Countdown Timer -->
            <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                <div class="flex items-center justify-center mb-2">
                    <i class="fas fa-external-link-alt text-red-500 mr-2"></i>
                    <span class="text-red-700 font-semibold">กำลังเปลี่ยนเส้นทาง...</span>
                </div>
                <div class="text-sm text-red-600">
                    <span>จะไปยัง LINE Developers ใน </span>
                    <span id="countdown" class="font-bold text-lg">3</span>
                    <span> วินาที</span>
                </div>
                <div class="mt-3">
                    <div class="w-full bg-red-200 rounded-full h-2">
                        <div id="countdownBar" class="bg-red-500 h-2 rounded-full transition-all duration-1000" style="width: 100%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Screen -->
    <div id="loading" class="fixed inset-0 bg-gradient-to-br from-yellow-400 to-amber-500 z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="relative mb-6">
                <i class="fas fa-coins text-8xl text-white animate-pulse"></i>
                <div class="absolute -top-2 -right-2 w-6 h-6 bg-white rounded-full animate-ping"></div>
            </div>
            <h2 class="text-white text-2xl font-bold mb-2">ระบบออมทอง</h2>
            <p id="loadingMessage" class="text-white/90 mb-6">กำลังเริ่มต้นระบบ...</p>
            
            <!-- Enhanced Progress Bar -->
            <div class="w-64 bg-white/20 rounded-full h-3 mb-4 overflow-hidden">
                <div id="loadingProgress" class="bg-white h-3 rounded-full transition-all duration-700 ease-out transform origin-left" style="width: 0%"></div>
            </div>
            
            <!-- Progress Percentage -->
            <div class="text-white/80 text-sm">
                <span id="loadingPercent">0%</span>
            </div>
        </div>
    </div> 

    <!-- Main App -->
    <div id="app" class="hidden">
        <!-- Header -->
        <div class="bg-gradient-to-r from-yellow-400 to-amber-500 p-4 shadow-lg">
            <div class="flex items-center space-x-3">
                <img id="userPic" src="https://cdn-icons-gif.flaticon.com/11255/11255995.gif" alt="Profile" class="w-12 h-12 rounded-full border-2 border-white">
                <div class="flex-1">
                    <h1 class="text-white font-bold text-lg">ระบบออมทอง</h1>
                    <p id="userName" class="text-white text-sm"></p>
                </div>
                <div class="text-right">
                    <p id="totalGold" class="text-white font-bold text-xl">จำนว:0 กรัม</p>
                    <p id="totalValue" class="text-white text-sm">มูลค่า: ฿0</p>
                </div>
            </div>
        </div>

        <!-- Content Container -->
        <div class="flex-1">
            <!-- Portfolio Content -->
            <div id="portfolioContent" class="p-4 page-container flex-1">
                <!-- Action Buttons -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <button onclick="navigateToPage('buy.html')" class="bg-green-500 text-white py-4 rounded-lg font-semibold hover:bg-green-600 transition card-hover btn-animate">
                        <i class="fas fa-plus-circle mr-2"></i>ซื้อทอง
                    </button>
                    <button onclick="navigateToPage('sell.html')" class="bg-red-500 text-white py-4 rounded-lg font-semibold hover:bg-red-600 transition card-hover btn-animate">
                        <i class="fas fa-minus-circle mr-2"></i>ขายทอง
                    </button>
                </div>

                <!-- Gold Balance Cards -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-white p-4 rounded-lg shadow card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm">ทองคำแท่ง</p>
                                <p id="barGold" class="text-xl font-bold text-yellow-600">0 กรัม</p>
                            </div>
                            <i class="fas fa-coins text-3xl text-yellow-500"></i>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm">ทองรูปพรรณ</p>
                                <p id="ornamentGold" class="text-xl font-bold text-yellow-600">0 กรัม</p>
                            </div>
                            <i class="fas fa-gem text-3xl text-yellow-500"></i>
                        </div>
                    </div>
                </div>

                <!-- Transaction History -->
                <div class="bg-white rounded-lg shadow p-4 card-hover">
                    <h3 class="font-bold text-lg mb-4"><i class="fas fa-history mr-2"></i>ประวัติการทำรายการ</h3>
                    <div id="transactionList" class="space-y-3">
                        <p class="text-gray-500 text-center">กำลังโหลด...</p>
                    </div>
                </div>
            </div>

            <!-- Dashboard Content -->
            <div id="dashboardContent" class="p-4 hidden page-container flex-1">
                <p class="text-center text-gray-500">กำลังโหลดข้อมูลราคาทอง...</p>
            </div>

            <!-- Wallet Content -->
            <div id="walletContent" class="p-4 hidden page-container flex-1">
                <!-- Wallet Balance -->
                <div class="bg-white rounded-lg shadow p-6 mb-4 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm">ยอดเงินคงเหลือ</p>
                            <p id="walletBalance" class="text-3xl font-bold text-green-600">฿0.00</p>
                        </div>
                        <i class="fas fa-wallet text-5xl text-green-500"></i>
                    </div>
                </div>

                <!-- Wallet Actions -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <button onclick="navigateToPage('topup.html')" class="bg-blue-500 text-white py-4 rounded-lg font-semibold hover:bg-blue-600 transition card-hover btn-animate">
                        <i class="fas fa-plus mr-2"></i>เติมเงิน
                    </button>
                    <button onclick="navigateToPage('withdraw.html')" class="bg-orange-500 text-white py-4 rounded-lg font-semibold hover:bg-orange-600 transition card-hover btn-animate">
                        <i class="fas fa-minus mr-2"></i>ถอนเงิน
                    </button>
                </div>

                <!-- Wallet History -->
                <div class="bg-white rounded-lg shadow p-4 card-hover">
                    <h3 class="font-bold text-lg mb-4"><i class="fas fa-list mr-2"></i>ประวัติกระเป๋าเงิน</h3>
                    <div id="walletHistory" class="space-y-3">
                        <p class="text-gray-500 text-center">กำลังโหลด...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fixed Bottom Tab Navigation -->
        <div class="bottom-tabs">
            <div class="flex h-full">
                <button id="portfolioTab" onclick="switchTab('portfolio')" class="tab-button flex-1 active">
                    <i class="fas fa-chart-pie text-lg mb-1"></i>
                    <span class="text-xs">พอร์ตโฟลิโอ</span>
                </button>
                <button id="dashboardTab" onclick="switchTab('dashboard')" class="tab-button flex-1">
                    <i class="fas fa-chart-line text-lg mb-1"></i>
                    <span class="text-xs">ราคาทอง</span>
                </button>
                <button id="walletTab" onclick="switchTab('wallet')" class="tab-button flex-1">
                    <i class="fas fa-wallet text-lg mb-1"></i>
                    <span class="text-xs">กระเป๋าเงิน</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let userData = {};
        let currentGoldData = { totalGold: 0, avgPrice: 0, balances: { bar: { totalGold: 0, avgPrice: 0 }, ornament: { totalGold: 0, avgPrice: 0 } } };
        let walletData = { balance: 0, transactions: [] };

        // Configuration - จำลองค่า config
        const LIFF_ID = 'your-liff-id';
        const API_URL = 'https://your-api-url.com/api';
        const GRAMS_PER_BAHT = 15.16;

        // Loading progress tracker
        let loadingSteps = 0;
        const totalSteps = 4;
        const loadingMessages = [
            'เชื่อมต่อ LINE...',
            'โหลดข้อมูลผู้ใช้...',
            'โหลดข้อมูลทอง...',
            'เสร็จสิ้น!'
        ];

        // Mobile Device Detection
        function detectMobileDevice() {
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;
            const screenWidth = window.screen.width;
            const screenHeight = window.screen.height;
            
            const mobileRegex = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i;
            const isMobileUserAgent = mobileRegex.test(userAgent);
            const isMobileScreen = screenWidth <= 768 || screenHeight <= 768;
            const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            
            return isMobileUserAgent || (isMobileScreen && isTouchDevice);
        }

        function isPCDevice() {
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;
            const screenWidth = window.screen.width;
            
            const desktopOS = /Windows NT|Macintosh|Linux/i.test(userAgent);
            const desktopBrowser = /Chrome|Firefox|Safari|Edge|Opera/i.test(userAgent) && 
                                  !/Mobile|Android|iPhone|iPad/i.test(userAgent);
            const largeScreen = screenWidth >= 1024;
            const hasMouseInput = !('ontouchstart' in window) || window.matchMedia('(pointer: fine)').matches;
            
            return (desktopOS && desktopBrowser) || (largeScreen && hasMouseInput);
        }

        function showMobileOnlyWarning() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('mobileOnlyWarning').classList.remove('hidden');
            document.getElementById('app').classList.add('hidden');
            
            let countdownTime = 3;
            const countdownElement = document.getElementById('countdown');
            const countdownBar = document.getElementById('countdownBar');
            
            const countdownInterval = setInterval(() => {
                countdownTime--;
                if (countdownElement) {
                    countdownElement.textContent = countdownTime;
                }
                if (countdownBar) {
                    countdownBar.style.width = ((countdownTime) / 3 * 100) + '%';
                }
                
                if (countdownTime <= 0) {
                    clearInterval(countdownInterval);
                    window.location.href = 'https://developers.line.biz/';
                }
            }, 1000);
        }

        function performDeviceCheck() {
            const isMobile = detectMobileDevice();
            const isPC = isPCDevice();
            
            if (isPC && !isMobile) {
                showMobileOnlyWarning();
                return false;
            }
            
            if (window.screen.width > 1200 && window.innerWidth > 1200) {
                showMobileOnlyWarning();
                return false;
            }
            
            return true;
        }

        function updateLoadingProgress(customMessage) {
            loadingSteps++;
            const progress = Math.min((loadingSteps / totalSteps) * 100, 100);
            const progressBar = document.getElementById('loadingProgress');
            const loadingMessage = document.getElementById('loadingMessage');
            const loadingPercent = document.getElementById('loadingPercent');
            
            if (progressBar) {
                progressBar.style.width = progress + '%';
            }
            
            if (loadingPercent) {
                loadingPercent.textContent = Math.round(progress) + '%';
            }
            
            if (loadingMessage) {
                const message = customMessage || loadingMessages[loadingSteps - 1] || 'กำลังโหลด...';
                loadingMessage.textContent = message;
            }
            
            if (loadingSteps >= totalSteps) {
                setTimeout(() => {
                    hideLoading();
                }, 500);
            }
        }

        function hideLoading() {
            const loadingElement = document.getElementById('loading');
            const appElement = document.getElementById('app');
            
            loadingElement.style.opacity = '0';
            loadingElement.style.transform = 'scale(0.95)';
            
            setTimeout(() => {
                loadingElement.classList.add('hidden');
                appElement.classList.remove('hidden');
                appElement.style.opacity = '0';
                appElement.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    appElement.style.transition = 'all 0.3s ease-out';
                    appElement.style.opacity = '1';
                    appElement.style.transform = 'translateY(0)';
                }, 50);
            }, 300);
        }

        // Navigation function
        function navigateToPage(page) {
            console.log('Navigating to:', page);
            // window.location.href = page;
        }

        // Tab switching - แก้ไขให้ทำงานได้ดีขึ้น
        function switchTab(tab) {
            // ซ่อนทุก content sections
            const contents = ['portfolioContent', 'dashboardContent', 'walletContent'];
            const tabs = ['portfolioTab', 'dashboardTab', 'walletTab'];
            
            contents.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.classList.add('hidden');
                }
            });
            
            tabs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.classList.remove('active');
                }
            });

            // แสดง content และ activate tab ที่เลือก
            if (tab === 'portfolio') {
                document.getElementById('portfolioContent').classList.remove('hidden');
                document.getElementById('portfolioTab').classList.add('active');
            } else if (tab === 'dashboard') {
                document.getElementById('dashboardContent').classList.remove('hidden');
                document.getElementById('dashboardTab').classList.add('active');
                loadDashboard();
            } else if (tab === 'wallet') {
                document.getElementById('walletContent').classList.remove('hidden');
                document.getElementById('walletTab').classList.add('active');
                loadWalletData();
            }
        }

        function loadDashboard() {
            console.log('Loading dashboard...');
            // เปลี่ยนเป็นโหลดข้อมูลในหน้าเดียวกันแทนการ redirect
            const dashboardContent = document.getElementById('dashboardContent');
            dashboardContent.innerHTML = `
                <div class="space-y-4">
                    <div class="bg-white rounded-lg shadow p-6 text-center">
                        <i class="fas fa-chart-line text-4xl text-yellow-500 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">ราคาทองคำวันนี้</h3>
                        <div class="grid grid-cols-2 gap-4 mt-4">
                            <div class="text-center">
                                <p class="text-sm text-gray-500">ทองคำแท่ง (ซื้อ)</p>
                                <p class="text-lg font-bold text-green-600">฿42,500</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-500">ทองคำแท่ง (ขาย)</p>
                                <p class="text-lg font-bold text-red-600">฿42,400</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 mt-4">
                            <div class="text-center">
                                <p class="text-sm text-gray-500">ทองรูปพรรณ (ซื้อ)</p>
                                <p class="text-lg font-bold text-green-600">฿43,000</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-500">ทองรูปพรรณ (ขาย)</p>
                                <p class="text-lg font-bold text-red-600">฿41,500</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4">
                        <h4 class="font-bold mb-2">แนวโน้มราคาทอง</h4>
                        <p class="text-sm text-gray-600">ราคาทองในวันนี้มีแนวโน้มเพิ่มขึ้นจากวันที่ผ่านมา</p>
                    </div>
                </div>
            `;
        }

        // Utility functions
        function formatNumber(num) {
            return num.toLocaleString('th-TH', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        }

        function formatCurrency(amount) {
            return amount.toLocaleString('th-TH', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        }

        // API Mock functions
        async function loadGoldData() {
            try {
                updateLoadingProgress('โหลดข้อมูลทอง...');
                
                // Mock data
                currentGoldData = {
                    totalGold: 15.55,
                    avgPrice: 42450,
                    balances: {
                        bar: { totalGold: 10.25, avgPrice: 42400 },
                        ornament: { totalGold: 5.30, avgPrice: 42500 }
                    }
                };
                
                const gramsPerBaht = GRAMS_PER_BAHT || 15.16;
                const totalValue = (currentGoldData.totalGold / gramsPerBaht) * currentGoldData.avgPrice;
                
                document.getElementById('totalGold').textContent = 'จำนวน:' + formatNumber(currentGoldData.totalGold) + ' กรัม';
                document.getElementById('totalValue').textContent = 'มูลค่า: ฿' + formatCurrency(totalValue);
                document.getElementById('barGold').textContent = formatNumber(currentGoldData.balances.bar?.totalGold || 0) + ' กรัม';
                document.getElementById('ornamentGold').textContent = formatNumber(currentGoldData.balances.ornament?.totalGold || 0) + ' กรัม';
                
            } catch (error) {
                console.error('Error loading gold data:', error);
                document.getElementById('totalGold').textContent = 'จำนวน:0 กรัม';
                document.getElementById('totalValue').textContent = 'มูลค่า: ฿0';
                document.getElementById('barGold').textContent = '0 กรัม';
                document.getElementById('ornamentGold').textContent = '0 กรัม';
            }
        }

        async function loadTransactions() {
            try {
                // Mock transactions data
                const mockTransactions = [
                    {
                        type: 'ซื้อ',
                        amount: 5.25,
                        goldType: 'bar',
                        price: 42400,
                        total: 14766,
                        date: '26/06/2025 14:30'
                    },
                    {
                        type: 'ขาย',
                        amount: 2.15,
                        goldType: 'ornament',
                        price: 41500,
                        total: 5883,
                        date: '25/06/2025 10:15'
                    }
                ];

                const transactionList = document.getElementById('transactionList');
                transactionList.innerHTML = '';
                
                if (mockTransactions.length === 0) {
                    transactionList.innerHTML = '<p class="text-gray-500 text-center">ยังไม่มีรายการ</p>';
                    return;
                }
                
                mockTransactions.forEach(transaction => {
                    const div = document.createElement('div');
                    div.className = 'flex justify-between items-center p-3 bg-gray-50 rounded-lg';
                    const typeColor = transaction.type === 'ซื้อ' ? 'text-green-600' : 'text-red-600';
                    const typeIcon = transaction.type === 'ซื้อ' ? 'fa-plus' : 'fa-minus';
                    const goldTypeText = transaction.goldType === 'bar' ? 'ทองคำแท่ง' : 'ทองรูปพรรณ';
                    div.innerHTML = `
                        <div>
                            <p class="font-semibold ${typeColor}">
                                <i class="fas ${typeIcon} mr-1"></i>
                                ${transaction.type} ${formatNumber(transaction.amount)} กรัม (${goldTypeText})
                            </p>
                            <p class="text-sm text-gray-500">${transaction.date}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold">฿${formatCurrency(transaction.price)}/บาท</p>
                            <p class="text-sm text-gray-500">฿${formatCurrency(transaction.total)}</p>
                        </div>
                    `;
                    transactionList.appendChild(div);
                });
                
            } catch (error) {
                console.error('Error loading transactions:', error);
                document.getElementById('transactionList').innerHTML = '<p class="text-gray-500 text-center">ไม่สามารถโหลดข้อมูลได้</p>';
            }
        }

        async function loadWalletData() {
            try {
                // Mock wallet data
                walletData = {
                    balance: 25000.50,
                    transactions: [
                        {
                            type: 'เติมเงิน',
                            amount: 10000,
                            date: '26/06/2025 09:30',
                            status: 'สำเร็จ',
                            bank: 'ธนาคารกสิกรไทย'
                        },
                        {
                            type: 'ซื้อทอง',
                            amount: -14766,
                            date: '26/06/2025 14:30',
                            status: 'สำเร็จ',
                            bank: ''
                        },
                        {
                            type: 'ขายทอง',
                            amount: 5883,
                            date: '25/06/2025 10:15',
                            status: 'สำเร็จ',
                            bank: ''
                        }
                    ]
                };

                document.getElementById('walletBalance').textContent = '฿' + formatCurrency(walletData.balance);

                const walletHistory = document.getElementById('walletHistory');
                walletHistory.innerHTML = '';

                if (walletData.transactions.length === 0) {
                    walletHistory.innerHTML = '<p class="text-gray-500 text-center">ยังไม่มีรายการ</p>';
                    return;
                }

                walletData.transactions.forEach(transaction => {
                    const div = document.createElement('div');
                    div.className = 'flex justify-between items-center p-3 bg-gray-50 rounded-lg';
                    
                    let typeColor, typeIcon;
                    if (transaction.type === 'เติมเงิน') {
                        typeColor = 'text-green-600';
                        typeIcon = 'fa-plus-circle';
                    } else if (transaction.type === 'อนุมัติถอนเงิน' || transaction.type === 'อนุมัติเติมเงิน') {
                        typeColor = 'text-green-600';
                        typeIcon = 'fa-check-circle';
                    } else if (transaction.type === 'ซื้อทอง') {
                        typeColor = 'text-blue-600';
                        typeIcon = 'fa-coins';
                    } else if (transaction.type === 'ขายทอง') {
                        typeColor = 'text-red-600';
                        typeIcon = 'fa-coins';
                    } else {
                        typeColor = 'text-red-600';
                        typeIcon = 'fa-minus-circle';
                    }

                    let statusColor;
                    if (transaction.status === 'สำเร็จ' || transaction.status === 'อนุมัติแล้ว') {
                        statusColor = 'text-green-500';
                    } else if (transaction.status === 'รอดำเนินการ' || transaction.status === 'รอการอนุมัติ') {
                        statusColor = 'text-yellow-500';
                    } else if (transaction.status === 'ยกเลิก' || transaction.status === 'ปฏิเสธ') {
                        statusColor = 'text-red-500';
                    } else {
                        statusColor = 'text-gray-500';
                    }

                    const amountPrefix = transaction.amount >= 0 ? '+' : '';
                    const amountColor = transaction.amount >= 0 ? 'text-green-600' : 'text-red-600';

                    div.innerHTML = `
                        <div>
                            <p class="font-semibold ${typeColor}">
                                <i class="fas ${typeIcon} mr-1"></i>
                                ${transaction.type}
                            </p>
                            <p class="text-sm text-gray-500">${transaction.date}</p>
                            <p class="text-xs ${statusColor}">${transaction.status}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold ${amountColor}">${amountPrefix}฿${formatCurrency(Math.abs(transaction.amount))}</p>
                            <p class="text-sm text-gray-500">${transaction.bank || ''}</p>
                        </div>
                    `;
                    walletHistory.appendChild(div);
                });
                
            } catch (error) {
                console.error('Error loading wallet data:', error);
                document.getElementById('walletBalance').textContent = '฿0.00';
                document.getElementById('walletHistory').innerHTML = '<p class="text-gray-500 text-center">ไม่สามารถโหลดข้อมูลได้</p>';
            }
        }

        // Initialize App
        async function initApp() {
            try {
                // Mock user data
                userData = {
                    userId: 'U1234567890',
                    name: 'ผู้ใช้ทดสอบ',
                    picture: 'https://cdn-icons-gif.flaticon.com/11255/11255995.gif'
                };
                
                document.getElementById('userName').textContent = userData.name;
                document.getElementById('userPic').src = userData.picture;
                
                updateLoadingProgress('โหลดข้อมูลทอง...');
                
                // โหลดข้อมูลแบบ parallel
                const dataPromises = [
                    loadGoldData().catch(console.error),
                    loadTransactions().catch(console.error),
                    loadWalletData().catch(console.error)
                ];
                
                await Promise.race([
                    Promise.all(dataPromises),
                    new Promise(resolve => setTimeout(resolve, 1000))
                ]);
                
                updateLoadingProgress('เสร็จสิ้น!');
                
                setTimeout(() => {
                    Promise.all(dataPromises).catch(console.error);
                }, 100);
                
            } catch (error) {
                console.error('Error initializing app:', error);
                updateLoadingProgress('เสร็จสิ้น!');
            }
        }

        // Main initialization
        window.onload = async function() {
            // ตรวจสอบอุปกรณ์ก่อนโหลดแอป
            if (!performDeviceCheck()) {
                return;
            }

            try {
                updateLoadingProgress('เชื่อมต่อ LINE...');
                
                // จำลองการเชื่อมต่อ LIFF
                await new Promise(resolve => setTimeout(resolve, 500));
                
                updateLoadingProgress('โหลดข้อมูลผู้ใช้...');
                await initApp();
                
            } catch (err) {
                console.error('App init failed:', err);
                updateLoadingProgress('เสร็จสิ้น!');
                setTimeout(() => {
                    alert('ไม่สามารถเชื่อมต่อระบบได้ กรุณาลองใหม่อีกครั้ง');
                }, 1000);
            }
        };

        // Event Listeners for responsive design
        window.addEventListener('resize', function() {
            if (window.innerWidth > 1200) {
                if (!document.getElementById('mobileOnlyWarning').classList.contains('hidden')) {
                    return;
                }
                showMobileOnlyWarning();
            }
        });

        window.addEventListener('orientationchange', function() {
            setTimeout(function() {
                if (window.innerWidth > 1200) {
                    showMobileOnlyWarning();
                }
            }, 500);
        });

        // Prevent context menu
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });

        // Prevent text selection on mobile
        document.addEventListener('selectstart', function(e) {
            e.preventDefault();
        });

        // Disable developer tools shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.keyCode === 123 || 
                (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74)) ||
                (e.ctrlKey && e.keyCode === 85)) {
                e.preventDefault();
                return false;
            }
        });

        // Prevent zoom gestures
        document.addEventListener('gesturestart', function(e) {
            e.preventDefault();
        });

        document.addEventListener('gesturechange', function(e) {
            e.preventDefault();
        });

        document.addEventListener('gestureend', function(e) {
            e.preventDefault();
        });

        // Monitor for developer tools
        setInterval(function() {
            if (window.outerHeight - window.innerHeight > 200 || 
                window.outerWidth - window.innerWidth > 200) {
                console.clear();
                console.log('%c🚫 Developer tools detected!', 'color: red; font-size: 20px; font-weight: bold;');
                console.log('%c📱 This application is designed for mobile devices only.', 'color: orange; font-size: 14px;');
            }
        }, 1000);
    </script>
</body>
</html>
